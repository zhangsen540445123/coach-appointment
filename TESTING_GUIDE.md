# 小程序个人中心功能测试指南

## 测试环境准备

### 1. 后端服务
确保后端服务正在运行：
```bash
docker ps | findstr coach-appointment-backend
```

如果没有运行，启动服务：
```bash
docker-compose up -d
```

### 2. 微信开发者工具
1. 打开微信开发者工具
2. 导入项目（选择 `app` 目录）
3. 点击"编译"按钮重新编译小程序
4. 打开"调试器" → "Console"标签（用于查看日志）
5. 打开"调试器" → "Network"标签（用于查看网络请求）

### 3. 开发者工具设置
确保以下设置已勾选：
- ✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
- ✅ 不校验安全域名、TLS 版本以及 HTTPS 证书

---

## 测试用例

### 测试 1：我的收藏页面

#### 测试步骤
1. 在小程序中点击底部"个人中心"标签
2. 点击"我的收藏"

#### 预期结果
- ✅ 页面能正常跳转（不再白屏）
- ✅ Console 显示以下日志：
  ```
  === toUserFocus 被调用 ===
  登录状态: true
  准备跳转到 /pages/user/userFocus
  跳转成功
  === 开始获取收藏列表 ===
  userId: 1
  === 收藏列表响应 === {...}
  原始列表数据: [...]
  处理后的列表数据: [...]
  ```
- ✅ Network 显示请求：`POST /api/vCounselor/getStarList`
- ✅ 如果有收藏数据，显示收藏的教练列表，包括：
  - 教练头像（方形）
  - 教练姓名
  - 资质标签
  - 城市位置
  - 个人简介
  - 擅长领域
  - 从业年限和咨询经验
  - 咨询价格
- ✅ 如果没有收藏数据，显示空状态界面：
  - 📋 图标
  - "暂无收藏的教练"
  - "快去收藏您喜欢的教练吧~"
- ✅ 点击教练卡片能跳转到教练详情页

#### 如果失败
- 检查 Console 中的错误日志
- 检查 Network 中的请求状态码
- 确认用户已登录（查看 `counselor_info` 存储）
- 检查是否有 JSON 解析错误
- 检查 `处理后的列表数据` 是否包含正确的字段

---

### 测试 2：联系客服功能

#### 测试步骤
1. 在小程序中点击底部"个人中心"标签
2. 点击"联系客服"

#### 预期结果
- ✅ 页面能正常跳转
- ✅ Console 显示以下日志：
  ```
  === contact page onLoad ===
  开始加载客服二维码
  获取客服二维码响应: {...}
  客服二维码URL: https://...
  ```
- ✅ Network 显示请求：`GET /api/global/settings`
- ✅ 页面显示客服二维码图片
- ✅ 显示提示文字："微信扫描此二维码添加客服微信"
- ✅ 长按图片可以保存到相册

#### 如果失败
- 检查 Console 中的错误日志
- 检查 Network 请求是否成功（状态码 200）
- 检查后端 `/api/global/settings` 接口是否正常
- 如果显示默认二维码，检查数据库中的 `customerServiceQrCode` 设置

---

### 测试 3：给我们反馈功能

#### 测试步骤（已登录）
1. 在小程序中点击底部"个人中心"标签
2. 点击"给我们反馈"
3. 输入反馈内容（例如："测试反馈功能"）
4. 点击"提交"按钮

#### 预期结果
- ✅ 页面能正常跳转
- ✅ Console 显示以下日志：
  ```
  === feedback page onLoad ===
  获取用户信息: {...}
  提交反馈，userId: 1
  提交反馈响应: {...}
  ```
- ✅ Network 显示请求：`POST /api/visitor/feedback/submit`
- ✅ 显示"提交成功"提示
- ✅ 1.5 秒后自动返回上一页

#### 测试步骤（未登录）
1. 清除登录状态（删除 `counselor_info` 存储）
2. 在小程序中点击底部"个人中心"标签
3. 点击"给我们反馈"
4. 输入反馈内容
5. 点击"提交"按钮

#### 预期结果
- ✅ 显示"请先登录"提示
- ✅ 1.5 秒后自动跳转到登录页面

#### 如果失败
- 检查 Console 中的错误日志
- 检查 Network 请求是否成功
- 检查后端 `/api/visitor/feedback/submit` 接口是否正常
- 检查用户登录状态

---

## 后台管理测试

### 测试 4：查看用户反馈

#### 测试步骤
1. 打开浏览器访问：`http://localhost:5173`
2. 登录后台管理系统
3. 点击左侧菜单"用户反馈"

#### 预期结果
- ✅ 显示反馈列表
- ✅ 可以看到刚才提交的测试反馈
- ✅ 可以查看反馈详情
- ✅ 可以标记为已处理
- ✅ 可以添加回复
- ✅ 可以删除反馈

---

### 测试 5：修改客服二维码

#### 测试步骤
1. 登录后台管理系统
2. 点击左侧菜单"系统设置"
3. 找到"客服二维码"上传区域
4. 上传新的二维码图片
5. 点击"保存设置"

#### 预期结果
- ✅ 图片上传成功
- ✅ 显示"设置保存成功"提示
- ✅ 在小程序"联系客服"页面刷新后显示新的二维码

---

## 常见问题排查

### 问题 1：页面跳转失败（404）
**原因**：页面未在 `app.json` 中注册
**解决**：检查 `app/app.json` 的 `pages` 数组是否包含目标页面路径

### 问题 2：API 请求失败（网络错误）
**原因**：后端服务未启动或 baseUrl 配置错误
**解决**：
1. 检查后端服务：`docker ps | findstr coach-appointment-backend`
2. 检查 `app/common/vendor.js` 中的 `baseUrl` 配置（应为 `http://localhost:8080/api`）

### 问题 3：用户未登录
**原因**：`counselor_info` 存储为空
**解决**：
1. 在小程序中重新登录
2. 检查 Console 中的登录日志
3. 检查 Storage 中是否有 `counselor_info` 数据

### 问题 4：图片不显示
**原因**：图片 URL 无效或网络问题
**解决**：
1. 检查 Console 中的图片 URL
2. 在浏览器中直接访问图片 URL 测试
3. 检查后台设置中的图片 URL 是否正确

---

## 调试技巧

### 1. 查看 Console 日志
所有修改的文件都添加了详细的日志输出，格式为：
```
=== 功能名称 ===
详细信息...
```

### 2. 查看 Network 请求
在 Network 标签中可以看到：
- 请求 URL
- 请求方法（GET/POST）
- 请求参数
- 响应数据
- 状态码

### 3. 查看 Storage
在 Storage 标签中可以查看：
- `counselor_info` - 用户登录信息
- 其他本地存储数据

### 4. 清除缓存
如果修改后没有生效：
1. 点击菜单栏"工具" → "清除缓存" → "清除全部缓存"
2. 重新编译小程序

---

## 测试检查清单

- [ ] 我的收藏页面能正常进入
- [ ] 我的收藏页面能正确显示数据或空状态
- [ ] 联系客服页面能正常进入
- [ ] 联系客服页面能正确显示二维码
- [ ] 给我们反馈页面能正常进入
- [ ] 给我们反馈功能能正常提交（已登录）
- [ ] 给我们反馈功能能正确处理未登录状态
- [ ] 后台管理能查看用户反馈
- [ ] 后台管理能修改客服二维码
- [ ] 所有 API 请求都能正常返回数据

---

## 测试完成后

如果所有测试都通过：
1. ✅ 标记所有问题为已解决
2. ✅ 提交代码到版本控制
3. ✅ 更新项目文档

如果有测试失败：
1. 记录失败的测试用例
2. 记录错误日志和截图
3. 根据错误信息进行调试
4. 修复后重新测试

